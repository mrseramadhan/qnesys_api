<html>
  <!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>WebSockets - Simple chat</title>
    <style>
      * { font-family:tahoma; font-size:12px; padding:0px;margin:0px;}
      p { line-height:18px; }
      div { width:800px; margin-left:auto; margin-right:auto;}
      #content { padding:5px; background:#ddd; border-radius:5px;
          border:1px solid #CCC; overflow-y: scroll;
          margin-top:10px; height: 160px; }
      #input { border-radius:2px; border:1px solid #ccc;
          margin-top:10px; padding:5px; width:400px;
      }
      #status { width:88px;display:block;float:left;margin-top:15px; }
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
    </script>
  </head>
  <body>
    <center><span id="countdown" class="timer"></span></center>

    <div id="content" style="height: 500px;"></div>
    <div>
      <span id="status">Connecting...</span>
      <input type="text" id="input" disabled="disabled" />
    </div>
    <table width="1200px" style="margin-left:auto; margin-right:auto; border: 1px solid black">
      <tr>
        <td>Preview</td>
        <td>Sebelum</td>
        <td>Posisi Bawah</td>
        <td>Posisi Kiri</td>
        <td>Dashboard Corner Bar</td>
        <td>Inside Dashboard Corner Bar</td>
      </tr>
      <tr>
        <td id="loc_1"></td>
        <td id="loc_2"></td>
        <td id="loc_3"></td>
        <td id="loc_4"></td>
        <td id="loc_5"></td>
        <td id="loc_6"></td>
      </tr>
    </table>
    <script>
      $(document).ready(function(){
        "use strict";  // for better performance - to avoid searching in DOM
        var content = $('#content');
        var input = $('#input');
        var status = $('#status');  // my color assigned by the server
        var myColor = false;
        // my name sent to the server
        var myName = false;  // if user is running mozilla then use it's built-in WebSocket
        window.WebSocket = window.WebSocket || window.MozWebSocket;  // if browser doesn't support WebSocket, just show
        // some notification and exit
        if (!window.WebSocket) {
          content.html($('<p>',
            { text:'Sorry, but your browser doesn\'t support WebSocket.'}
          ));
          input.hide();
          $('span').hide();
          return;
        }  // open connection
        var connection = new WebSocket('ws://127.0.0.1:1337');  connection.onopen = function () {
          // first we want users to enter their names
          input.removeAttr('disabled');
          status.text('API-Token: ');
        };  connection.onerror = function (error) {
          // just in there were some problems with connection...
          content.html($('<p>', {
            text: 'Sorry, but there\'s some problem with your '
               + 'connection or the server is down.'
          }));
        };  // most important part - incoming messages
        connection.onmessage = function (message) {
          // try to parse JSON message. Because we know that the server
          // always returns JSON this should work without any problem but
          // we should make sure that the massage is not chunked or
          // otherwise damaged.
          try {
            content.prepend(message.data+'<hr>');
            var res=JSON.parse(message.data);
            if(res.id_ads_location)
            {
                $('#loc_'+res.id_ads_location).html('<img src="'+"http://candahar.com/SmartHotel/public/assets/img/"+res.file+'" width="100px">');
            }
          } catch (e) {
            console.log('Invalid JSON: ', message.data);
            return;
          }    // NOTE: if you're not sure about the JSON structure
        };  /**
         * Send message when user presses Enter key
         */
        input.keydown(function(e) {
          if (e.keyCode === 13) {
            var msg = $(this).val();
            if (!msg) {
              return;
            }
            // send the message as an ordinary text
            connection.send(JSON.stringify({"type":"token","value":msg}));
            let countdown = setInterval('timer()', 1000);
            //$(this).val('');
            // disable the input field to make the user wait until server
            // sends back response
            input.attr('disabled', 'disabled');      // we know that the first message sent from a user their name
            if (myName === false) {
              myName = msg;
            }
          }
        });  /**
         * This method is optional. If the server wasn't able to
         * respond to the in 3 seconds then show some error message
         * to notify the user that something is wrong.
         */
        setInterval(function() {
          if (connection.readyState !== 1) {
            status.text('Error');
            input.attr('disabled', 'disabled').val(
                'Unable to communicate with the WebSocket server.');
          }
        }, 3000);  /**
         * Add message to the chat window
         */
        function addMessage(author, message, color, dt) {
          content.prepend('<p><span style="color:' + color + '">'
              + author + '</span> @ ' + (dt.getHours() < 10 ? '0'
              + dt.getHours() : dt.getHours()) + ':'
              + (dt.getMinutes() < 10
                ? '0' + dt.getMinutes() : dt.getMinutes())
              + ': ' + message + '</p>');
        }
      });
    </script>
    <script>
      var upgradeTime = 1;
      var seconds = upgradeTime;
      function timer() {
        var days        = Math.floor(seconds/24/60/60);
        var hoursLeft  = Math.floor((seconds) - (days*86400));
        var hours      = Math.floor(hoursLeft/3600);
        var minutesLeft = Math.floor((hoursLeft) - (hours*3600));
        var minutes    = Math.floor(minutesLeft/60);
        var remainingSeconds = seconds % 60;
        function pad(n) {
          return (n < 10 ? "0" + n : n);

        }
        document.getElementById('countdown').innerHTML =pad(hours) + ":" + pad(minutes) + ":" + pad(remainingSeconds);
        if (seconds == 0) {
          clearInterval(countdownTimer);
          document.getElementById('countdown').innerHTML = "Completed";
        } else {
          seconds++;
        }
      }
    //  var countdown = setInterval('timer()', 1000);
    </script>
  </body>
</html>
</html>
